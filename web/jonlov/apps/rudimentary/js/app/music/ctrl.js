app.directive("player",["$templateRequest","$compile","uiLoad","$ocLazyLoad","$rootScope","$state","$cookies",function(a,b,c,d,e,f,g){return{restrict:"E",link:function(h,i){return c.load(["https://www.youtube.com/iframe_api","https://w.soundcloud.com/player/api.js"]).then(function(){return d.load(["player-modules"])}).then(function(){return a("/tpl/blocks/player/player.youtube.html").then(function(a){return i.append(a),h.$on("youtube.player.ready",function(a,b){e.player.info=b.getVideoData(),h.player.YT=b})})}).then(function(b){return a("/tpl/blocks/player/player.soundcloud.html").then(function(a){return i.append(a),h.$on("soundcloud.player.ready",function(a,b){return h.player.SC=b,b.getCurrentSound(function(a){e.player.info=a,e.$apply()})})})}).then(function(){var a=function(){return g.getObject(h.app.shortName+"-player-queue")},c={info:{playing:0},play:function(){h.player.YT&&(h.YTUrl?h.player.YT.playVideo():h.player.SC.play())},pause:function(){h.player.YT&&(h.YTUrl?h.player.YT.pauseVideo():h.player.SC.pause(),this.info.playing)},toggle:function(){var a=!1;h.player.YT&&(a=h.player.YT.getPlayerState()),h.player.SC&&!h.YTUrl?h.player.SC.isPaused(function(a){a?this.play():this.pause()}):2!=a?this.pause():this.play()}};h.YTPlayerVars={autoplay:1,autohide:1,showinfo:1,controls:1,rel:0},h.SCPlayerVars={auto_play:!0,buying:!0,liking:!1},c.load=function(b){var d=c.queue.current(),e=d>-1?d:0;a()||g.putObject(h.app.shortName+"-player-queue",[]),a()&&b&&c.queue.stop(),a()&&!b&&(b=a()[e]?a()[e].url:b||null);var i=f.params.id||b,j=b?b.replace("http://","").replace("https://","").replace("www.","").split(/[/?#]/)[0]:null;j&&"soundcloud.com"===j?(h.player.YT&&h.player.YT.stopVideo(),h.player.SC&&(c.info=h.player.SC.getCurrentSound(function(a){return a})),h.YTUrl=!1,h.trackURL=i,h.player.SC&&!h.YTUrl&&(h.player.SC.seekTo(0),h.player.SC.isPaused(function(a){a&&h.player.SC.play()}))):(h.player.SC&&h.player.SC.isPaused(function(a){a||h.player.SC.pause()}),h.player.YT&&(c.info=h.player.YT.getVideoData()),h.YTUrl=!0,h.videoURL="https://www.youtube.com/embed/"+i,h.player.YT&&h.YTUrl&&(h.player.YT.seekTo(0,!0),1!==h.player.YT.getPlayerState()&&h.player.YT.playVideo()))};var d=function(a,b,c){for(var d=0;d<a.length;d++)if(a[d][b]==c)return d;return-1};c.queue={list:a()||[],load:function(a){var b=this.current();c.queue.list[b]&&delete this.list[b].current,this.list[a].current=!0,g.putObject(h.app.shortName+"-player-queue",this.list),c.load()},all:function(){return this.list},current:function(){return d(this.list,"current",!0)},add:function(a,b,c,e){var f=d(this.list,"url",e),i={source:a,title:b,image:c,url:e};-1===f&&(this.list.push(i),g.putObject(h.app.shortName+"-player-queue",this.list))},"delete":function(a,b,c,d,e){a>-1&&(this.list.splice(a,1),g.putObject(h.app.shortName+"-player-queue",this.list))},save:function(a){this.list=a,g.putObject(h.app.shortName+"-player-queue",a)},next:function(){if(this.list){var a=this.current();a>-1&&(this.list[a]&&delete this.list[a].current,this.list[a+1]?(delete this.list[a].current,this.list[a+1].current=!0):(delete this.list[a].current,this.list[0].current=!0),g.putObject(h.app.shortName+"-player-queue",this.list),c.load())}},prev:function(){if(this.list){var a=this.current(),b=this.list.length-1;a>-1&&this.list[a-1]?(delete this.list[a].current,this.list[a-1].current=!0):(delete this.list[b].current,this.list[b].current=!0),g.putObject(h.app.shortName+"-player-queue",this.list),c.load()}},stop:function(){if(this.list){var a=this.current();a>-1&&delete this.list[a].current,g.putObject(h.app.shortName+"-player-queue",this.list)}}},e.$on("player",function(a,b){"toggle"===b&&c.toggle()}),h.$on("youtube.player.ended",function(a,b){c.queue.next()}),h.$on("soundcloud.player.finish",function(a,b){c.queue.next()}),$(".dd").on("change",function(){var a=$(".dd").nestable("serialize"),b=[];for(count in a)b.push(a[count].$scope.queue);c.queue.save(b)}),e.player=c,c.load(),b(i.contents())(h)})}}}]);