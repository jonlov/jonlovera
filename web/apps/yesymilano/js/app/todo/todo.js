app.factory("todoStorage",function(){var STORAGE_ID="todos";return{get:function(){return JSON.parse(localStorage.getItem(STORAGE_ID)||"[]")},put:function(todos){localStorage.setItem(STORAGE_ID,JSON.stringify(todos))}}}),app.controller("TodoCtrl",["$scope","$location","$filter","todoStorage",function($scope,$location,$filter,todoStorage){var todos=$scope.todos=todoStorage.get();$scope.newTodo="",$scope.remainingCount=$filter("filter")(todos,{completed:!1}).length,""===$location.path()&&$location.path("/"),$scope.location=$location,$scope.$watch("location.path()",function(path){console.log(path),$scope.statusFilter={"/app/todo/active":{completed:!1},"/app/todo/completed":{completed:!0}}[path]}),$scope.$watch("remainingCount == 0",function(val){$scope.allChecked=val}),$scope.addTodo=function(){var newTodo=$scope.newTodo.trim();0!==newTodo.length&&(todos.push({title:newTodo,completed:!1}),todoStorage.put(todos),$scope.newTodo="",$scope.remainingCount++)},$scope.editTodo=function(todo){todo.editedTodo=!0,$scope.originalTodo=angular.extend({},todo)},$scope.doneEditing=function(todo){todo.editedTodo=!1,todo.title=todo.title.trim(),todo.title||$scope.removeTodo(todo),todoStorage.put(todos)},$scope.revertEditing=function(todo){todos[todos.indexOf(todo)]=$scope.originalTodo,$scope.doneEditing($scope.originalTodo)},$scope.removeTodo=function(todo){$scope.remainingCount-=todo.completed?0:1,todos.splice(todos.indexOf(todo),1),todoStorage.put(todos)},$scope.todoCompleted=function(todo){$scope.remainingCount+=todo.completed?-1:1,todoStorage.put(todos)},$scope.clearCompletedTodos=function(){$scope.todos=todos=todos.filter(function(val){return!val.completed}),todoStorage.put(todos)},$scope.markAll=function(completed){todos.forEach(function(todo){todo.completed=completed}),$scope.remainingCount=completed?0:todos.length,todoStorage.put(todos)}}]);